(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{508:function(s,t,a){s.exports=a.p+"assets/img/1024-1-awslscli-1-install-cli.04f99aac.jpg"},509:function(s,t,a){s.exports=a.p+"assets/img/1024-1-awslscli-2-user.601fc3cd.jpg"},510:function(s,t,a){s.exports=a.p+"assets/img/1024-1-awslscli-3-access-type.2fe94d46.png"},511:function(s,t,a){s.exports=a.p+"assets/img/1024-1-awslscli-4-user-permissions.a302c140.jpg"},512:function(s,t,a){s.exports=a.p+"assets/img/1024-1-awslscli-5-permission-boundary-fullac.1d8389db.jpg"},513:function(s,t,a){s.exports=a.p+"assets/img/1024-1-awslscli-6-pboundary-lightexport.24c144b3.jpg"},514:function(s,t,a){s.exports=a.p+"assets/img/1024-1-awslscli-7-cli-aws-configure.9a419850.jpg"},515:function(s,t,a){s.exports=a.p+"assets/img/1024-1-awslscli-8-redundant-para.23b1a585.jpg"},516:function(s,t,a){s.exports=a.p+"assets/img/1024-1-awslscli-9-test.42c48548.jpg"},538:function(s,t,a){"use strict";a.r(t);var e=a(4),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"summary"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[s._v("#")]),s._v(" Summary")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1. environment: win10, aws-cli-v2\n2. currently, IAM permission boundary is not useful for litmitting the use of LightSail cli.\n3. currently, aws-cli-v2 `aws configure` command just overwrite the claimed para in `credential` file and this may cause problem when you didn't remove your previous credential before configuration.\n4. `ca-central-1a`, the `a` is the `availability zone`.\n5. command for testing: aws lightsail get-instance-metric-data --instance-name [OMMITTED] --period 60 --metric-name CPUUtilization --start-time 1603584900 --unit Percent --end-time 1603600522  --statistics Average\n6. To Migrate LightSail Instance, coping the snapshot to the target region\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h2",{attrs:{id:"_1-install-cli-client"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-install-cli-client"}},[s._v("#")]),s._v(" 1. Install CLI client")]),s._v(" "),e("p",[e("img",{attrs:{src:a(508),alt:"image"}})]),s._v(" "),e("p",[s._v("I already installed cli tools before. The upper one is the recent package I used and the lower one is the old package from 2018.")]),s._v(" "),e("h2",{attrs:{id:"_2-create-iam-programmatic-user-for-cli"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-create-iam-programmatic-user-for-cli"}},[s._v("#")]),s._v(" 2. Create IAM programmatic user for CLI")]),s._v(" "),e("p",[s._v("Then cli needs an account to access LightSail resources. I was following this document: "),e("a",{attrs:{href:"https://lightsail.aws.amazon.com/ls/docs/en_us/articles/lightsail-how-to-set-up-access-keys-to-use-sdk-api-cli",target:"_blank",rel:"noopener noreferrer"}},[s._v("AWS LightSail DOCS - set up access keys to use sdk api cli"),e("OutboundLink")],1),s._v(". So go to IAM to create one and the steps were as following.")]),s._v(" "),e("p",[e("img",{attrs:{src:a(509),alt:"image"}}),s._v(" "),e("img",{attrs:{src:a(510),alt:"image"}}),s._v(" "),e("img",{attrs:{src:a(511),alt:"image"}})]),s._v(" "),e("p",[s._v("What I care here is the permission boundary setting. If it is not set then you will have a notice in the review section of creating user. So... what they have as permission boundaries? Let's see......")]),s._v(" "),e("p",[e("img",{attrs:{src:a(512),alt:"image"}}),s._v(" "),e("img",{attrs:{src:a(513),alt:"image"}})]),s._v(" "),e("p",[e("strong",[s._v("Permission Boundary - LightSail Full Access")])]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Version"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2012-10-17"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Statement"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Sid"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VisualEditor0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Effect"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Allow"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Action"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lightsail:*"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Resource"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[e("strong",[s._v("Permission Boundary - LightSail Export")])]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Version"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2012-10-17"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Statement"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Effect"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Allow"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Action"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"iam:DeleteServiceLinkedRole"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"iam:GetServiceLinkedRoleDeletionStatus"')]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Resource"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"arn:aws:iam::*:role/aws-service-role/lightsail.amazonaws.com/AWSServiceRoleForLightsail*"')]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Effect"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Allow"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Action"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ec2:CopySnapshot"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ec2:DescribeSnapshots"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ec2:CopyImage"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ec2:DescribeImages"')]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Resource"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("p",[s._v("As you can see, the first one is merely usable and the second one is not applicable. If I want to have a permission boundary, so the option given is to confirm the IAM have a full access? Hmmmm.... funny 😦.... So at the end I didn't set a permission boundary.")]),s._v(" "),e("p",[s._v("At the end, the access key will be provided at an one-time page. Just take that csv file.")]),s._v(" "),e("h2",{attrs:{id:"_3-configuate-aws-cli"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-configuate-aws-cli"}},[s._v("#")]),s._v(" 3. Configuate AWS CLI")]),s._v(" "),e("p",[s._v('Then open up a "prompt" and call configure command: '),e("code",[s._v("aws configure")]),s._v(".\n"),e("img",{attrs:{src:a(514),alt:"image"}})]),s._v(" "),e("p",[s._v("But I had made 2 mistakes when configuring. One was putting a wrong region name. Second was not putting a default output format. The correct region in my case is "),e("code",[s._v("ca-central-1")]),s._v(' without that "a". (so when to specify the availability zone?). If putting an availability zone to region para, an error will happen when using cli, which is '),e("code",[s._v('Could not connect to the endpoint URL: "https://lightsail.ca-central-1a.amazonaws.com/"')]),s._v(".")]),s._v(" "),e("p",[s._v("And I didn't have the chance to see what exceptions second one will cause since I realized the problem when solving the first one.")]),s._v(" "),e("p",[s._v("AWS has multiple resources having availability zone settings.")]),s._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("EC2 Availability Zone"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("RDS Availability Zone"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://lightsail.aws.amazon.com/ls/docs/en_us/articles/understanding-regions-and-availability-zones-in-amazon-lightsail",target:"_blank",rel:"noopener noreferrer"}},[s._v("LightSail Availability Zone"),e("OutboundLink")],1)])]),s._v(" "),e("p",[s._v("And the way to migrate LightSail accross different regions is basically to copy snapshots.")]),s._v(" "),e("p",[s._v("Ref: "),e("a",{attrs:{href:"https://lightsail.aws.amazon.com/ls/docs/en_us/articles/amazon-lightsail-copying-snapshots-from-one-region-to-another",target:"_blank",rel:"noopener noreferrer"}},[s._v("Copying snapshots from one AWS Region to another in Amazon Lightsail"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("But even I corrently input those para, there's still an error: "),e("code",[s._v("The security token included in the request is invalid")]),s._v(". So I first searched online, but everyone is telling you need to set up security token when having MFA settings. But I didn't enable MFA for this account. Then I checked credential file and fount out there is an redundant para 😦..... guess what? Cli configure command is too lazy to delete redundant para from my previous default credential para when configuring but it just want to use all para when being called.")]),s._v(" "),e("p",[e("img",{attrs:{src:a(515),alt:"image"}})]),s._v(" "),e("h2",{attrs:{id:"_4-test"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-test"}},[s._v("#")]),s._v(" 4. Test")]),s._v(" "),e("p",[s._v("The command I use to test availability of cli is:\n"),e("img",{attrs:{src:a(516),alt:"image"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);